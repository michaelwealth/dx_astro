---
import logoSvg from '../assets/logos/Digtal Xceeded Logo.svg';
import logoIcon from '../assets/logos/Dxicon.svg';

const navItems = [
  { label: 'Services', href: '/services', hasDropdown: true },
  { label: 'Portfolio', href: '/portfolio' },
  { label: 'About', href: '/about' },
  { label: 'Insights', href: '/insights' },
  { label: 'Contact', href: '/contact' },
];

const serviceItems = [
  { 
    category: 'Brand & Experience',
    items: [
      { label: 'Branding & Design', href: '/services/branding-design' },
      { label: 'UI/UX Design', href: '/services/ui-ux-design' },
      { label: 'Experiential Marketing', href: '/services/experiential-marketing' },
      { label: 'Video Production', href: '/services/video-production' },
    ]
  },
  { 
    category: 'Digital Platforms',
    items: [
      { label: 'Web Development', href: '/services/web-development' },
      { label: 'App Development', href: '/services/app-development' },
      { label: 'Platform Support', href: '/services/platform-support' },
      { label: 'AI & Tools Integration', href: '/services/ai-integration' },
    ]
  },
  { 
    category: 'Growth & Media',
    items: [
      { label: 'Search Engine Marketing', href: '/services/sem' },
      { label: 'Paid Social', href: '/services/paid-social' },
      { label: 'Display & Retargeting', href: '/services/display-retargeting' },
      { label: 'Media Relations', href: '/services/media-relations' },
    ]
  },
  { 
    category: 'Strategy & Advisory',
    items: [
      { label: 'Digital Strategy', href: '/services/digital-strategy' },
      { label: 'Consulting & Advisory', href: '/services/consulting' },
      { label: 'Training Programs', href: '/services/training' },
      { label: 'Audits & Reviews', href: '/services/audits' },
    ]
  },
];

const currentPath = Astro.url.pathname;
---

<header class="header" id="header">
  <div class="header-container">
    <a href="/" class="logo" aria-label="Digital Xceeded Home">
      <div class="logo-wrapper">
        <img src={logoSvg.src} alt="Digital Xceeded" class="logo-full" width="180" height="40" />
        <img src={logoIcon.src} alt="DX" class="logo-icon" width="40" height="40" />
      </div>
    </a>
    
    <nav class="nav" aria-label="Main navigation">
      <ul class="nav-list">
        {navItems.map((item) => (
          <li class={`nav-item ${item.hasDropdown ? 'has-dropdown' : ''}`}>
            <a 
              href={item.href} 
              class={`nav-link ${currentPath.startsWith(item.href) ? 'active' : ''}`}
              aria-expanded={item.hasDropdown ? 'false' : undefined}
            >
              {item.label}
              {item.hasDropdown && (
                <svg class="dropdown-icon" width="10" height="6" viewBox="0 0 10 6" fill="none">
                  <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              )}
            </a>
            {item.hasDropdown && (
              <div class="mega-menu" aria-hidden="true">
                <div class="mega-menu-inner">
                  <div class="mega-menu-header">
                    <span class="mega-menu-title">Our Services</span>
                    <p class="mega-menu-subtitle">Integrated expertise across four pillars</p>
                  </div>
                  <div class="mega-menu-grid">
                    {serviceItems.map((category) => (
                      <div class="mega-menu-column">
                        <span class="mega-menu-category">{category.category}</span>
                        <ul class="mega-menu-list">
                          {category.items.map((subItem) => (
                            <li>
                              <a href={subItem.href} class="mega-menu-link">
                                {subItem.label}
                              </a>
                            </li>
                          ))}
                        </ul>
                      </div>
                    ))}
                  </div>
                  <div class="mega-menu-footer">
                    <a href="/services" class="mega-menu-cta">
                      View all services
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M3 8H13M13 8L8 3M13 8L8 13" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                      </svg>
                    </a>
                  </div>
                </div>
              </div>
            )}
          </li>
        ))}
      </ul>
    </nav>
    
    <div class="header-actions">
      <button 
        class="theme-toggle" 
        id="theme-toggle"
        type="button"
        aria-label="Toggle dark mode"
        title="Toggle dark mode"
      >
        <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="12" cy="12" r="5"></circle>
          <line x1="12" y1="1" x2="12" y2="3"></line>
          <line x1="12" y1="21" x2="12" y2="23"></line>
          <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
          <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
          <line x1="1" y1="12" x2="3" y2="12"></line>
          <line x1="21" y1="12" x2="23" y2="12"></line>
          <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
          <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
      </button>
      <a href="/contact" class="btn btn-primary btn-header">
        Start a Project
      </a>
    </div>
    
    <button class="mobile-menu-btn" aria-label="Toggle menu" aria-expanded="false">
      <span class="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </button>
  </div>
  
  <!-- Mobile Menu -->
  <div class="mobile-menu" aria-hidden="true">
    <nav class="mobile-nav">
      <ul class="mobile-nav-list">
        {navItems.map((item) => (
          <li class="mobile-nav-item">
            {item.hasDropdown ? (
              <>
                <button class="mobile-nav-toggle" aria-expanded="false">
                  {item.label}
                  <svg class="dropdown-icon" width="12" height="8" viewBox="0 0 10 6" fill="none">
                    <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                </button>
                <div class="mobile-submenu">
                  {serviceItems.map((category) => (
                    <div class="mobile-submenu-category">
                      <button class="mobile-category-toggle" aria-expanded="false">
                        {category.category}
                        <svg class="dropdown-icon" width="10" height="6" viewBox="0 0 10 6" fill="none">
                          <path d="M1 1L5 5L9 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </button>
                      <ul class="mobile-category-items">
                        {category.items.map((subItem) => (
                          <li>
                            <a href={subItem.href}>{subItem.label}</a>
                          </li>
                        ))}
                      </ul>
                    </div>
                  ))}
                </div>
              </>
            ) : (
              <a href={item.href} class="mobile-nav-link">{item.label}</a>
            )}
          </li>
        ))}
      </ul>
      <div class="mobile-menu-cta">
        <a href="/contact" class="btn btn-primary btn-lg">Start a Project</a>
      </div>
    </nav>
  </div>
</header>

<style>
  .header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: var(--header-height);
    background: rgba(248, 246, 243, 0.9);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    z-index: 1000;
    transition: all var(--transition-base);
  }
  
  [data-theme="dark"] .header {
    background: rgba(26, 26, 28, 0.95);
    border-bottom-color: rgba(255, 255, 255, 0.1);
  }
  
  .header.scrolled {
    background: rgba(255, 255, 255, 0.98);
    box-shadow: var(--shadow-md);
    height: 70px;
  }
  
  [data-theme="dark"] .header.scrolled {
    background: rgba(26, 26, 28, 0.98);
  }
  
  .header-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 100%;
    max-width: var(--container-max);
    margin: 0 auto;
    padding: 0 var(--space-xl);
  }
  
  .logo {
    position: relative;
    display: flex;
    align-items: center;
  }
  
  .logo-wrapper {
    position: relative;
    height: 40px;
    display: flex;
    align-items: center;
  }
  
  .logo-full {
    height: 36px;
    width: auto;
    opacity: 1;
    transform: translateX(0);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .logo-icon {
    position: absolute;
    left: 0;
    height: 36px;
    width: auto;
    opacity: 0;
    transform: translateX(-20px) scale(0.8);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .header.scrolled .logo-full {
    opacity: 0;
    transform: translateX(-30px);
    pointer-events: none;
  }
  
  .header.scrolled .logo-icon {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
  
  .logo:hover .logo-full,
  .logo:hover .logo-icon {
    filter: brightness(0.9);
  }
  
  .nav-list {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    list-style: none;
  }
  
  .nav-link {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    font-family: var(--font-display);
    font-size: 0.9375rem;
    font-weight: 500;
    color: #1a1a1a;
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
  }
  
  .nav-link:hover {
    color: var(--color-primary);
    background: rgba(255, 87, 87, 0.05);
  }
  
  .nav-link.active {
    color: var(--color-primary);
  }
  
  .dropdown-icon {
    transition: transform var(--transition-fast);
  }
  
  .has-dropdown:hover .dropdown-icon {
    transform: rotate(180deg);
  }
  
  /* Mega Menu */
  .mega-menu {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%) translateY(10px);
    width: 100%;
    max-width: 1000px;
    padding-top: 0;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* Invisible bridge to prevent hover gap */
  .mega-menu::before {
    content: '';
    position: absolute;
    top: -20px;
    left: 0;
    right: 0;
    height: 20px;
  }
  
  .has-dropdown:hover .mega-menu,
  .has-dropdown:focus-within .mega-menu {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateX(-50%) translateY(0);
  }
  
  .mega-menu-inner {
    background: var(--color-surface);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-xl);
    padding: var(--space-2xl);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }
  
  [data-theme="dark"] .mega-menu-inner {
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  .mega-menu-header {
    margin-bottom: var(--space-xl);
    padding-bottom: var(--space-lg);
    border-bottom: 1px solid var(--color-soft-gray);
  }
  
  .mega-menu-title {
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 700;
    color: #1a1a1a;
  }
  
  .mega-menu-subtitle {
    font-size: 0.875rem;
    color: #666666;
    margin-top: var(--space-xs);
  }
  
  .mega-menu-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-2xl);
  }
  
  .mega-menu-category {
    display: block;
    font-family: var(--font-display);
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-primary);
    margin-bottom: var(--space-md);
  }
  
  .mega-menu-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }
  
  .mega-menu-link {
    display: block;
    font-size: 0.9375rem;
    color: #1a1a1a;
    padding: var(--space-xs) 0;
    transition: all var(--transition-fast);
  }
  
  .mega-menu-link:hover {
    color: var(--color-primary);
    transform: translateX(4px);
  }
  
  .mega-menu-footer {
    margin-top: var(--space-xl);
    padding-top: var(--space-lg);
    border-top: 1px solid var(--color-soft-gray);
  }
  
  .mega-menu-cta {
    display: inline-flex;
    align-items: center;
    gap: var(--space-sm);
    font-family: var(--font-display);
    font-weight: 600;
    color: var(--color-primary);
    transition: gap var(--transition-fast);
  }
  
  .mega-menu-cta:hover {
    gap: var(--space-md);
  }
  
  .header-actions {
    display: flex;
    align-items: center;
    gap: var(--space-md);
  }
  
  .theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--color-surface);
    border: 2px solid var(--color-soft-gray);
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: all var(--transition-fast);
    color: var(--color-text);
  }
  
  [data-theme="dark"] .theme-toggle {
    background: var(--color-soft-gray);
    border-color: var(--color-warm-gray);
    color: var(--color-text);
  }
  
  .theme-toggle:hover {
    background: var(--color-soft-gray);
    border-color: var(--color-warm-gray);
  }
  
  .theme-toggle:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }
  
  .theme-toggle .icon-moon {
    display: none;
  }
  
  [data-theme="dark"] .theme-toggle .icon-sun {
    display: none;
  }
  
  [data-theme="dark"] .theme-toggle .icon-moon {
    display: block;
  }
  
  .btn-header {
    padding: var(--space-sm) var(--space-lg);
    font-size: 0.875rem;
  }
  
  /* Mobile Menu Button */
  .mobile-menu-btn {
    display: none;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
    background: transparent;
    border: none;
    cursor: pointer;
    z-index: 1001;
  }
  
  .hamburger {
    display: flex;
    flex-direction: column;
    gap: 5px;
    width: 24px;
  }
  
  .hamburger span {
    display: block;
    height: 2px;
    background: var(--color-text);
    border-radius: var(--radius-full);
    transition: all var(--transition-base);
  }
  
  .hamburger span:nth-child(1) { width: 100%; }
  .hamburger span:nth-child(2) { width: 75%; }
  .hamburger span:nth-child(3) { width: 50%; }
  
  .mobile-menu-btn[aria-expanded="true"] .hamburger span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }
  
  .mobile-menu-btn[aria-expanded="true"] .hamburger span:nth-child(2) {
    opacity: 0;
  }
  
  .mobile-menu-btn[aria-expanded="true"] .hamburger span:nth-child(3) {
    width: 100%;
    transform: rotate(-45deg) translate(5px, -5px);
  }
  
  /* Mobile Menu */
  .mobile-menu {
    top: var(--header-height);
    left: 0;
    right: 0;
    bottom: 0;
    background: #f8f6f3;
    padding: var(--space-xl);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all var(--transition-base);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    z-index: 999;
  }
  
  [data-theme="dark"] .mobile-menu {
    background: #1a1a1c;
  }
  
  .mobile-menu[aria-hidden="false"] {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  .mobile-nav-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
  }
  
  .mobile-nav-link,
  .mobile-nav-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--space-md) 0;
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 600;
    color: #1a1a1a;
    background: transparent;
    border: none;
    border-bottom: none;
    cursor: pointer;
    text-align: left;
    text-decoration: none;
  }
  
  [data-theme="dark"] .mobile-nav-link,
  [data-theme="dark"] .mobile-nav-toggle {
    color: #ffffff;
  }
  
  .mobile-submenu {
    display: none;
    padding: var(--space-md) 0;
  }
  
  .mobile-nav-toggle[aria-expanded="true"] + .mobile-submenu {
    display: block;
  }
  
  .mobile-nav-toggle[aria-expanded="true"] .dropdown-icon {
    transform: rotate(180deg);
  }
  
  .mobile-submenu-category {
    margin-bottom: var(--space-sm);
  }
  
  .mobile-category-title {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--color-primary);
    margin-bottom: var(--space-sm);
  }
  
  .mobile-category-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: var(--space-sm) 0;
    font-family: var(--font-display);
    font-size: 0.875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--color-primary);
    background: transparent;
    border: none;
    cursor: pointer;
    text-align: left;
  }
  
  .mobile-category-toggle .dropdown-icon {
    transition: transform var(--transition-fast);
    opacity: 0.6;
  }
  
  .mobile-category-toggle[aria-expanded="true"] .dropdown-icon {
    transform: rotate(180deg);
  }
  
  .mobile-category-items {
    display: none;
    list-style: none;
    padding-left: var(--space-md);
    padding-bottom: var(--space-sm);
  }
  
  .mobile-category-toggle[aria-expanded="true"] + .mobile-category-items {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }
  
  .mobile-submenu ul {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }
  
  .mobile-submenu a {
    display: block;
    padding: var(--space-xs) 0;
    font-size: 0.875rem;
    color: #666666;
    text-decoration: none;
  }
  
  [data-theme="dark"] .mobile-submenu a {
    color: rgba(255, 255, 255, 0.7);
  }
  
  .mobile-submenu a:hover {
    color: var(--color-primary);
  }
  
  .mobile-menu-cta {
    margin-top: var(--space-2xl);
  }
  
  .mobile-menu-cta .btn {
    width: 100%;
  }
  
  /* Responsive */
  @media (max-width: 1024px) {
    .nav,
    .header-actions {
      display: none;
    }
    
    .mobile-menu-btn {
      display: flex;
    }
  }
</style>

<script>
  // Header scroll effect with smooth logo transition
  const header = document.getElementById('header');
  let lastScroll = 0;
  let ticking = false;
  
  function updateHeader() {
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > 50) {
      header?.classList.add('scrolled');
    } else {
      header?.classList.remove('scrolled');
    }
    
    lastScroll = currentScroll;
    ticking = false;
  }
  
  window.addEventListener('scroll', () => {
    if (!ticking) {
      window.requestAnimationFrame(updateHeader);
      ticking = true;
    }
  });
  
  // Mobile menu toggle
  const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
  const mobileMenu = document.querySelector('.mobile-menu');
  
  mobileMenuBtn?.addEventListener('click', () => {
    const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
    mobileMenuBtn.setAttribute('aria-expanded', String(!isExpanded));
    mobileMenu?.setAttribute('aria-hidden', String(isExpanded));
    document.body.style.overflow = isExpanded ? '' : 'hidden';
  });
  
  // Mobile submenu toggle
  document.querySelectorAll('.mobile-nav-toggle').forEach(toggle => {
    toggle.addEventListener('click', () => {
      const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', String(!isExpanded));
    });
  });
  
  // Mobile category toggle (nested dropdowns)
  document.querySelectorAll('.mobile-category-toggle').forEach(toggle => {
    toggle.addEventListener('click', () => {
      const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', String(!isExpanded));
    });
  });
  
  // Theme toggle
  const themeToggle = document.getElementById('theme-toggle');
  const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
  
  function getTheme() {
    const stored = localStorage.getItem('theme');
    if (stored) return stored;
    return prefersDark.matches ? 'dark' : 'light';
  }
  
  function setTheme(theme: string) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    themeToggle?.setAttribute('aria-label', theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode');
  }
  
  // Initialize theme
  setTheme(getTheme());
  
  // Handle toggle click
  themeToggle?.addEventListener('click', () => {
    const current = document.documentElement.getAttribute('data-theme') || 'light';
    setTheme(current === 'dark' ? 'light' : 'dark');
  });
  
  // Listen for system preference changes
  prefersDark.addEventListener('change', (e) => {
    if (!localStorage.getItem('theme')) {
      setTheme(e.matches ? 'dark' : 'light');
    }
  });
</script>
